\section{Methods}
\label{hptpcPaper:sec:Methods}

    \subsection{CERN Beam Test}
    The beam test took place in the 0.8~GeV T10 beam line, East Area at the Proton Synchrotron in CERN from the 15th August to the 18th September 2018.
    The primary experimental setup for the data taking period is shown in figure~\ref{fig:setup}.
    \begin{figure}
    \includegraphics[width=1.0\linewidth]{files/Figures/T10Diagram.jpg}
    	\caption{Beam test configuration}
    		\label{fig:setup}
    \end{figure}
    The centre of the HPTPC Prototype was placed 13~m from the wire chamber at the beam entrance. 
    Three Time of Flight constituents, labeled S1 to S3, were placed upstream of the TPC, while the 4th, labeled S4, was placed directly downstream.
    Both the TPC and Time of Flight systems were placed at an off axis angle with respect to the direction of the beam.
    Additionally, a variable number of blocks of acrylic moderator, shown in Figure~\ref{fig:modblocks}, were placed in the beamline, upstream of S1.
      \begin{figure}
      \centering
    \includegraphics[width=0.2\linewidth]{files/Figures/ModeratorBlocks.jpg}
    	\caption{Acrylic Moderator Blocks}
    		\label{fig:modblocks}
    \end{figure}
    
    Moderator blocks were used in order to cause a spread in the incoming beam.
    The blocks cause protons to scatter through a larger angle than pions and other minimum ionising particles (MIP), increasing the off-axis proton pion ratio.
    The effect of this, together with placing the TPC and ToF systems off axis was to allow a measurement of protons with a lower pion background.
    This technique also had the effect of reducing the average momentum of the measured particles.
    Data were taken for 0, 1, 2, 3, and 4 moderator blocks in turn.
    The beam ran with an energy of 0.8~GeV, and primarily comprised protons and pions, as well as muons and electrons. 
    Beam spills were approximately 500~ms in length, with 5-10~s between spills.
    The ratio of protons to pions expected in the T10 beam  is shown in figure~\ref{beamcharacteristics}.
    From this figure, the expected on axis proton pion ratio at 0.8~GeV is approximately 1:6.
      \begin{figure}
      \centering
    \includegraphics[width=0.6\linewidth]{files/Figures/offaxismeasurement.png}
    	\caption{T10 beam constituents (REFERENCE NEEDED)}
    		\label{fig:beamcharacteristics}
    \end{figure}
    
    
	\subsection{Upstream beam counters S1 and S2}
	
	S1 and S2 are shown in figure~\ref{fig:modblocks}. 
    S1 is a $40\times40\times5$~mm$^3$ plastic scintillator tile which is attached to four 1'' Hamamatsu R4998 photoubes from four ends for the light readout. 
    The time resolution of the counter, as measured by the DAQ system of the upstream ToF, was about 30 ps.
    S2 were placed 1~m downstream of S1. The size of the scintillator tile,  $120\times120\times5$~mm$^3$, was adjuster to account for the beam divergence in the moderator blocks. The light was collected by a 2'' PMT R13089 which was connected to the scintillator via long light-guide as shown in figure~\ref{fig:modblocks}. 
    The discriminated signal from this PMT together with a signal from one of the S1 PMTs was fed to a coincidence unit.  This signal was further used by the downstream ToF for the time-of-flight identification.
    
    
    \subsection{Upstream Time of Flight instrumentation (S3)}
    
    The sketch of the upstream ToF detector is shown in figure \ref{fig:S3sketch}.
     \begin{figure}
      \centering
    \includegraphics[width=0.6\linewidth]{files/Figures/uToF_sketch.pdf}
    	\caption{Sketch of the S3 wall}
    		\label{fig:S3sketch}
    \end{figure}
It was assembled of 22 staggered bars:  20 bars with dimensions $1.68 \times 6 \times 1$~cm$^3$ 
and 2 bars of  $1.5 \times 6 \times 1$~cm$^3$ placed on top and bottom.
The overlap between bars was set to 5~mm, thus the active area of the detector was approximately 1.68 m $\times$ 1.22 m.
The material of the bar,
EJ-200, provides a suitable optical attenuation length 4~m
and fast timing (rise time of 0.9~ns and decay time 2.1~ns). 
The emission spectrum of EJ-200 resides in the violet region of the visible spectrum.
Arrays of eight $6 \times 6$~mm$^2$ area silicone photomultipliers (SiPMs) from Hamamatsu Photonics were coupled to both ends of the bar to collect photons produced in de-excitation processes evoked by ionizing particles crossing the scintillator.
Anode signals of SiPMs have been read out and summed by an 8-channel SiPM anode readout integrated circuit MUSIC-R1. 
The construction of the prototype was a joint effort between groups of Geneva and Zurich universities as a part of R\&D for the Timing detector of the SHIP experiment \cite{AK}.

A 64-ch SAMPIC  module was used for the data acquisition.
A SAMPIC chip is a Waveform and Time to Digital Converter (WTDC) multichannel ASIC which provides a raw time with an ultrafast analog memory allowing fine timing extraction as well as other parameters of the pulse \cite{SAMPIC}. 
Each channel integrates a discriminator that can trigger itself independently or participate to a more complex trigger. 

A mean time of light signals detected at two ends of a single bar provides a time reference with the resolution of about 100 ps, while the time difference gives a position of the interaction along the bar. An example of a reconstructed $XY$ distribution is shown in Figure \ref{ }.

    
    
    The S3 wall was placed directly upstream of the TPC.
    The placement of each of the four time of fligh constituents in respect to the TPC is shown in figure~\ref{fig:S1S2S3S4}.
    \begin{figure}
      \centering
    \includegraphics[width=0.6\linewidth]{files/Figures/S1S2S3S4.png}
    	\caption{Position of the time of flight constituents in the T10 beam hall. The TPC prototype and beam entrance are also shown}
    		\label{fig:S1S2S3S4}
    \end{figure}
    



	\subsection{Downstream Time of Flight instrumentation (S4)}
	
    The downstream time of flight system, $S4$, consists of 10 bars of Nuvia plastic scintillator, which form the detector medium. 
    Attached to either end of each of these scintillator bars is a 5" Hamamatsu R6594 photomultiplier tube. 
    The bars are arranged in two rows of five, such that there is complete coverage for any beam particles incident upon the detector. 
    Diagrams of the $S4$ wall, along with its dimensions are presented in figure~\ref{fig:dstofFront} and~\ref{fig:dstofDiagonal}.
    The time resolution of the bars and photomultiplier tubes (PMT) was measured to be 1~ns. The corresponding spatial resolution of the bars and PMTs was measured to be 8.3~cm.
    
    \begin{figure}[ht]    
    	\begin{minipage}[t]{.48\textwidth}
    		\centering
    		\includegraphics[width=0.6\linewidth]{files/Figures/dstofFront.png}
    		\caption{Front view of the downstream time of flight system}
    		\label{fig:dstofFront}
    	\end{minipage}
    	\hspace{0.3cm}
    	\begin{minipage}[t]{.48\textwidth}
    		\centering
    		\includegraphics[width=0.45\linewidth]{files/Figures/dstofDiag.png}
    		\caption{Diagonal view of the downstream time of flight system showing more clearly the two rows of scintillator bars and photomultiplier tubes}
    		\label{fig:dstofDiagonal}
    	\end{minipage}
    \end{figure}
    
    All 20 of the photomultiplier tubes have their anode signals read out using NIM discriminators which are then fed into a time-to-digital converter. 
    A signal (i.e. an incident particle of any kind) in $S4$ was considered to have occurred if a signal was seen in both photomultiplier tubes on the same bar within 20~ns of each other.
    
    Additionally, a signal was also fed into the same time-to-digital converter whenever there was a coincidence between the $S1$ and $S2$ timing points. 
    When calculating the time of flight of a given particle, this time of coincidence was used as first timing point.
    
    \subsection{The HPTPC Prototype}
    The prototype was built at Royal Holloway, University London.
    The steel vessel was rated to 6~barA of pressure, and the walls of the vessel were 4~cm thick (THIS NEEDS CHECKING).
    The TPC comprised thin steel mesh electrodes (one cathode and three anodes), and 12 copper rings to create the uniform drift field.
    The drift distance produced was 48~cm, with the anodes separated by 1~mm.
    Data taking with the TPC made use of both optical and charge readout.
    The vessel, electrodes, and drift region of the TPC are shown in figure~\ref{fig:TPC}.
    
     \begin{figure}
      \centering
    \includegraphics[width=0.6\linewidth]{files/Figures/IMG_1194.jpg}
    	\caption{Cross-sectional view of the TPC; the thing mesh electrodes and copper ring drift volume can be seen inside the steel vessel}
    		\label{fig:TPC}
    \end{figure}
    
    The centre of the TPC was placed 13~m from the beam entrance with S3 and S4 directly upstream and downstream of the vessel, respectively.
    Throughout the run, the TPC was filled with either pure Argon, or a combination of Argon and a small percentage of quencher.
    
	\subsection{Analysis methods -- $S4$}

	Figure~\ref{fig:s4tof} shows the variation in the time of flight spectrum as recorded by $S4$ with a changing number of moderator blocks. 
	This spectrum given by the difference in time between observation of a coincidence in the $S1$ and $S2$ timing points and a signal being recorded in $S4$ (the definition of an $S4$ signal is given above).
	
	\begin{figure}[h]
		\begin{adjustbox}{max totalsize={.8\textwidth}{.7\textheight},center}
			\input{files/Figures/s4BkgSub_axisAdj.tex}
		\end{adjustbox}
		\caption{$S4$ time-of-flight spectra for varying numbers of moderator blocks. For all configurations, an exponentially falling background has been fitted and subtracted from the data. Additionally, the plot has also been corrected for the differing efficiencies of the various bars.}
		\label{fig:s4tof}	
	\end{figure}

	Furthermore, two corrections are applied to this measurement to give fig.~\ref{fig:s4tof}. 
	Timing delays caused by cabling and equipment are taken into account:
	A Gaussian is fitted to the peak caused by faster particles.
	All times are normalised such that the mean of this peak is at a value of $S4 - S1$ corresponding to a particle traversing the distance between $S1$ and $S4$ at the speed of light. 
	The other times are then shifted by the same amount.
	
	Additionally, the measurements are corrected for the efficiency of each bar. 
	The efficiency of a bar is calculated by dividing the number of signal hits in coincidence with an $S1-S2$ signal in each bar by the total number of PMT hits in each bar (themselves in coincidence with an $S1-S2$ signal). 
	If the number of single PMT hits which are in coincidence with $S1-S2$ signal is expressed as $N_{1PMTcoins}$ and the number of 2 PMT signals in coincidence with an $S1-S2$ signal is expressed as $N_{2PMTcoins}$, then the efficiency is given by~(\ref{eq:barEff}).
	
	\begin{equation}
		\epsilon = \frac{N_{2PMTcoins}}{N_{2PMTcoins}+N_{1PMTcoins}}
		\label{eq:barEff}
	\end{equation}
	
	Using fig.~\ref{fig:s4tof}, protons and MIPs are selected with timing cuts. 
	These timing cuts are chosen by fitting a sum of signal and background functions to the time of flight spectra shown in figure~\ref{fig:s4tof}. 
	The signal functions are taken to be Gaussians while the background is taken to be an exponential function. 
	An example of this is shown in figure~\ref{fig:fitEx}.
	The particles in the quicker timing window (those for which $t_{S4}-t_{S1}<55~\text{ns}$ and $t_{S4}-t_{S1}>40~\text{ns}$) are considered to be minimum ionizing particles while those in the slower timing window (those for which $t_{S4}-t_{S1}<105~\text{ns}$ and $t_{S4}-t_{S1}>66~\text{ns}$) are considered to be protons.
	
	\begin{figure}[h]
		\begin{adjustbox}{max totalsize={.7\textwidth}{.62\textheight},center}
			\input{files/Figures/1_dtof1d.tex}
		\end{adjustbox}
		\caption{Example of the time of flight spectrum observed in $S4$ with a combined signal and background function fitted (shown in black)}
		\label{fig:fitEx}
	\end{figure}

	To produce the data used in this analysis, an exponential background function is subtracted. 
	The parameters for this function are taken from the combined signal and background function.

	