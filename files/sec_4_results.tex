\section{Beam Flux Measurement}
\label{hptpcPaper:sec:Results}

\subsection{Flux measurements with S3}

The ToF systems are at an off-axis angle with respect to the beam axis (see Table~\ref{tab:angS1}), in order to probe the reduced proton momentum spectrum, to cover the region most relevant for neutrino experiments and the measure the flux passing through the TPC.
This is quantified in terms of $\theta$ and $\phi$ (see Section~\ref{sec:coord}).

\begin{figure}[ht]
  \centering
  \begin{minipage}[t]{0.49\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}, center}
      \input{files/Figures/proKeAll.tex}
    \end{adjustbox}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.49\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}, center}
      \input{files/Figures/protonKeTpc.tex}
    \end{adjustbox}
  \end{minipage}
  \caption{\label{fig:s3proke}Proton kinetic energy spectrum as measured in $\mathit{S3}$. Left: all protons. Right: the subset of protons passing through the HPTPC drift volume}
\end{figure}

%\begin{figure}[ht]
%  \centering
%  \begin{adjustbox}{max totalsize={0.5\textwidth}, center}
%      \input{files/Figures/protonKeTpc.tex}
%  \end{adjustbox}
%  \caption{Proton kinetic energy spectrum as measured in $\mathit{S3}$ for those protons passing through the HPTPC drift volume.}
%  \label{fig:tpcproke}
%\end{figure} 

The proton spectra upstream of the TPC are shown in figures~\ref{fig:s3proke}.
Figure~\ref{fig:s3proke}, left, shows the kinetic energy of particles identified as protons is successfully reduced with increasing numbers of moderator blocks, with the range falling from 210-320~MeV for the unmoderated beam, to 60-110~MeV for 4~acrylic blocks.
Figure~\ref{fig:s3proke}, right, shows the kinetic energy spectrum of protons crossing into the TPC.
This figure indicates that the flux of low energy protons (those with a kinetic energy of less than 80~MeV) reaching the TPC was increased from negligible in the 0, 1, and 2 block cases to ($9.7 \pm 0.1$) per spill for the 4 block case.
Comparing Figure~\ref{fig:s3proke}, right, with Figure~\ref{fig:protonsfromargon} shows that, for the four moderator block case, the kinetic energy of protons incident upon the TPC is just above the 50~MeV region where the different neutrino interaction generators become discrepant.
These protons lose further energy within the walls of the HPTPC vessel, resulting in a flux of protons below 50~MeV within the TPC.

The combination of the use of moderator blocks and positioning the TPC in an off-axis position also caused a change in the multiplicity of protons passing through the TPC.
Figure~\ref{fig:s3proke}, right, shows that the addition of 1, 2, and 3 moderator blocks increased the number of protons passing through the TPC from ($19.0 \pm 0.9$) per spill in the unmoderated case to ($108 \pm 3$) per spill in the 3 block case.
The addition of the fourth moderator block effectively removes the flux of protons above 100~MeV, leaving ($21.4 \pm 0.2$) per spill to traverse the TPC active volume.
  
\begin{figure}[h]
  \begin{minipage}{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/thetaS1pi.tex}
    \end{adjustbox}
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/thetaS1pro.tex}
    \end{adjustbox}
  \end{minipage}
    \caption{\label{fig:s1s3mips}Distribution of hits in $\mathit{S3}$ as a function of the horizontal off-axis angle, measured from $\mathit{S1}$, for varying numbers of moderator blocks. No coincident hit in $\mathit{S2}$ was required. Left: minimum ionizing particles. Right: protons.}
\end{figure}

The distributions vs. off-axis angle of MIPs and protons in $\mathit{S3}$ are shown in Figure~\ref{fig:s1s3mips}.
In both cases, the peak beam intensity falls and broadens in $\theta$ with the increasing number of moderator blocks. 
At off-axis angles the number of MIPs and protons is increased as the number of moderator blocks is increased.
The TPC lies within this off-axis region.
The spread of particles for unmoderated data was unexpected; this peak was broadened by the beam steering scattering that led to the double proton peaks seen in figures~\ref{fig:s3tof} and \ref{fig:s3tof_mass}.
For the unbent and unmoderated beam, the measured horizontal FWHM is 9.6~cm while the vertical FWHM is 11.0~cm.
This is compared with the measured horizontal FWHM for the unmoderated and steered beam of 16.8~cm.

Figure~\ref{fig:propiratio_s3_horz} shows the proton-MIP ratio measured in $\mathit{S3}$ as a function of the nominal off-axis angle, horizontally and vertically respectively, and for various numbers of moderator blocks.
For 0, 1, 2, and 3 moderator blocks the ratio falls to a minimum at approximately $1^{\circ}$ with respect to the beam axis.
This corresponds to the true beam centre for the steered beam.
As the angle moves away from the true beam centre, the ratio rises for these configurations.
The peak of the proton-MIP ratio shifts away from the beam centre progressively as more moderator blocks are added (from approximately $1^{\circ}$ away from beam centre for 0 blocks up to approximately $3^{\circ}$ away from beam centre for 3 blocks).
At most values of $\theta$, the proton-MIP ratio falls with the addition of more moderator blocks. 
That is to say, reducing the kinetic energy of the protons below 100~MeV came at the cost of reducing the purity of the proton beam.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/thetaS1ratio.tex}
    \end{adjustbox}
    
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/phiS1ratio.tex}
    \end{adjustbox}
  \end{minipage}	
  \caption{\label{fig:propiratio_s3_horz}Proton-MIP ratio in $\mathit{S3}$ for varying numbers of moderator blocks as a function of off-axis angle, as measured from $\mathit{S1}$.  Left: horizontal angle. Right: vertical angle. The TPC spans horizontal angles 1.4--3.6$^{ \circ }$. and vertical angles -2.6--+2.6$^{ \circ }$.}
\end{figure}

\subsection{Flux measurements with S4}
\label{sec:s4Flux}

Figure~\ref{fig:thetas4mip}, left, shows the flux of particles identified as minimum ionizing particles across $\mathit{S4}$.
%This flux is shown as as a function of the off-axis angles defined in Section~\ref{sec:coord} for varying numbers of moderator blocks.
For all numbers of moderator blocks, the peak number of minimum ionizing particle events occurs at a value of $\theta$ between $-1^{\circ}$ and $-2^{\circ}$.
Similarly the number of proton events per spill, shown in Figure~\ref{fig:thetas4mip}, right, peaks at a value of $\theta$ of approximately $-2^{\circ}$.
The fall in the number of events between $\theta = -1^{\circ}$ and $\theta = 0^{\circ}$ is as a result of the beam impinging on the vessel doors at these angles.
The positioning and shape of the pressure vessel doors means that, for particles travelling at these angles, a greater length of steel is passed through compared to those particles which strike the body of the vessel.

%The angular overlap of $\mathit{S2}$ and $\mathit{S4}$ plays a role in the position of the peak. 
%Figure~\ref{fig:angularDistS1} shows that, when observed from $\mathit{S1}$, a limited area of $\mathit{S4}$ is shadowed by the active area of $\mathit{S2}$.
%Given the requirement that a signal must be observed in $\mathit{S2}$, it is clear that all of the events that are observed in $\mathit{S4}$ are from this region of overlap.

Figure~\ref{fig:thetas4mip}. left, also shows that initially, an increasing number of moderator blocks results in an increased total MIP flux through $\mathit{S4}$. 
This is because both $\mathit{S2}$ and $\mathit{S4}$ are positioned off-axis, so the unmoderated beam particles do not strike these detectors.
Due to scattering processes in the moderator, a greater number of MIPs are incident upon $\mathit{S2}$ and $\mathit{S4}$, with more scattering occurring with greater numbers of moderator blocks.
However, with the fourth moderator block the flux of MIPs is seen to fall.
%The drop off in the number of MIPs observed in the four block data is likely due to the overscattering of the protons and MIPs as stated previously.
Similarly, with the addition of the first two moderator blocks, the proton flux shown in Figure~\ref{fig:thetas4mip}, right, initially sees an increase in the total number of events in $\mathit{S4}$.
However, with three and four moderator blocks, the total number of protons observed in $\mathit{S4}$ falls.
The initial proton flux increase is similar to that for the MIP flux, with increased scattering causing more protons to pass through the off-axis $\mathit{S2}$ and $\mathit{S4}$ detectors.
The subsequent decrease is due to the larger loss of energy of the protons in the thicker moderator.
In turn, this leads to attenuation of protons in the pressure vessel resulting in fewer observed events in $\mathit{S4}$.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/piS4Horz_new.tex}
    \end{adjustbox}
    
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/proS4Horz_new.tex}
    \end{adjustbox}
  \end{minipage} 
  \caption{\label{fig:thetas4mip}Distribution of hits in $\mathit{S4}$ as a function of the number of moderator blocks and the horizontal off-axis angle. Left: minimum ionizing particles. Right: protons.}
\end{figure}	

Figure~\ref{fig:propiratio_s4_horz} shows the ratio of protons to MIPs as a function of the number of moderator blocks, $\theta$ and $\phi$.
For all of the different block configurations, the ratio is flat across both $\theta$ and $\phi$.
With the addition of moderator blocks, the ratio reduces from its highest level of 0.5 for the 0 block case, to 0.002 for the 4 block data.
As mentioned previously, this is thought to be due to the attenuation of low energy protons within the walls of the pressure vessel.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/ratioS4Horz_new.tex}
    \end{adjustbox}
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/ratioS4Vert_new.tex}
    \end{adjustbox}
  \end{minipage}	
  \caption{\label{fig:propiratio_s4_horz}Proton-MIP ratio in $\mathit{S4}$ for varying numbers of moderator blocks as a function of off-axis angle. Left: horizontal off-axis angle. Right: vertical off-axis angle.}
\end{figure}

\subsection{Monte Carlo Studies}
\label{sec:mcStudies}
In order to ascertain the flux of protons reaching the active region of the TPC, and verify the corrections described above, a Monte Carlo (MC) simulation study was performed.
The simulation was performed using GEANT4~\cite{brun1993geant}, with geometric volumes approximating the vessel, TPC, and time of flight systems.
In order to match upstream conditions as closely as possible, particle momenta were drawn from the $\mathit{S3}$ distributions shown in Figure~\ref{fig:s3proke}, left, and simulated with trajectories that resulted in the same position distribution as seen in Figure~\ref{fig:s3XY_pion}, right.
The same timing cuts described in Section~\ref{timeofflightanalysissubsec} were applied.

\begin{figure}[ht]
  \centering
     \begin{adjustbox}{max totalsize={\textwidth}{.3\textheight}, center}
      \input{files/Figures/proKeS4Mc.tex}
    \end{adjustbox}
    \caption{Energy profile of simulated protons reaching $\mathit{S4}$, with kinetic energy above the detection threshold of 10~MeV.}
    \label{fig:MCS4}
\end{figure}

The simulated protons are propagated through the vessel to the $\mathit{S4}$ detector.
The momentum profile of simulated protons reaching the $\mathit{S4}$ wall is shown in Figure~\ref{fig:MCS4}.
A proton detection threshold of $\mathit{S4}$ of 140~MeV/c (10~MeV kinetic energy) is included.
The simulation shows a significant reduction in kinetic energy as most particles have travelled through both steel walls of the TPC vessel.
In particular, in the 4 moderator block case, very few particles have survived through the second vessel wall to reach $\mathit{S4}$.

\begin{figure}[h]
  \centering
  \begin{adjustbox}{max totalsize={.35\textheight}, center}
    \input{files/Figures/tofS4Sim.tex}
  \end{adjustbox}
  \caption{Comparison of simulated and measured proton ToF between $\mathit{S2}$ and $\mathit{S4}$. The solid lines indicate the simulated distribution while the points are data. All distributions are area normalised to 1.}
  \label{fig:tofMC}
\end{figure}

Comparisons of $\mathit{S2}$ to $\mathit{S4}$ time of flight for data and MC are shown in Figure~\ref{fig:tofMC} for varying numbers of moderator blocks.
Figure~\ref{fig:tofMC} shows that, for all numbers of moderator blocks, the peak positions in the data and MC spectra agree to within 2~ns.
This level of agreement shows that the simulated energy loss in the vessel and TPC is similar to the energy loss in the data.
  
Systematic uncertainties on the number of protons measured in $\mathit{S3}$ and $\mathit{S4}$ are estimated for both data and MC, and shown in Table~\ref{tab:systematics}.
The systematic uncertainty on the MC simulation is determined by varying the geometric initial conditions of the simulation, including the position of the $\mathit{S1}$ and $\mathit{S2}$ detectors.
These variations induce changes in the direction and momenta of the propagated protons.
Additionally, a study was performed with 1~cm of additional acrylic in the beamline, as a proxy for the uncertainty on other pieces of light material in the beam facility.
This set of calculated errors represents geometric sources of uncertainty in the MC simulation.

The uncertainty on the overall efficiency of $\mathit{S3}$ is calculated by taking the $\pm1\sigma$ uncertainty on the linear relationship between $\mathit{S1} \cap \mathit{S2}$ signals in the upstream and downstream ToF DAQs (see Section~\ref{timeofflightanalysissubsec}) and calculating the fractional change this causes in the $\mathit{S3}$ proton count.

The uncertainty on the overall efficiency of $\mathit{S4}$ is calculated from the calibration tests performed on the $\mathit{S4}$ bars with a Sr$^{90}$ source, as discussed in Section~\ref{timeofflightanalysissubsec}.
The overall efficiency factor of 0.8 was calculated using data taken with a significantly different readout to that used in the beam test and therefore is subject to variation. 
The spread in maximum bar efficiencies measured in these Sr$^{90}$ source tests for the various $\mathit{S4}$ bars is used as the systematic uncertainty on the overall $\mathit{S4}$ efficiency.

For the data, the $\mathit{S4}$ angular correction systematic uncertainty is assessed by varying the number of horizontal bins in Figure~\ref{fig:s4PosEff} from 20 to 10.
The uncertainty on the $\mathit{S4}$ background subtraction is determined by taking the $1\sigma$ error on the fitted flat background and determining the resulting change in the number of protons.
This has a larger effect in the 4 block case because of the very small number of protons detected in $\mathit{S4}$ relative to the background.

\begin{table}
  \centering
  \caption{List of systematic errors and values for data and MC simulation. All values are the percent error on the $\mathit{S4}$ proton count with the exception of the uncertainty on the efficiency of $\mathit{S3}$, which is the percent error in the $\mathit{S3}$ proton count. All uncertainties are treated as uncorrelated. $n_{\mathit{S4},~MC}$ refers to the number of protons reaching $\mathit{S4}$ in MC simulations.}
  \begin{tabular}{c|c c c c c}
    \hline
    \hline
    \multicolumn{6}{c}{\textbf{Monte Carlo}} \\
    \hline
    & \multicolumn{5}{c}{Number of moderator blocks} \\
    & 0 & 1 & 2 & 3 & 4 \\
    \hline
    Systematic uncertainty on $n_{\mathit{S4},~MC}$ & 9.5\% & 8.0\% & 8.5\% & 17.0\% & 8.0\% \\
    \hline
    \multicolumn{6}{c}{} \\
    \multicolumn{6}{c}{} \\
    \hline
    \hline
    \multicolumn{6}{c}{\textbf{Data}} \\
    \hline
    & \multicolumn{5}{c}{Number of moderator blocks} \\
    Source of systematic error & 0 & 1 & 2 & 3 & 4 \\
    \hline
    Absolute efficiency of $\mathit{S3}$ & 1.1\% & 11.4\% & 7.0\% & 11.4\% & 4.9\% \\
    Absolute efficiency of $\mathit{S4}$ & 11.0\% & 11.0\% & 11.0\% & 11.0\% & 11.0\% \\ 
    $\mathit{S4}$ angular correction & 2.9\% & 1.5\% & 6.7\% & 8.2\% & 4.1\% \\
    $\mathit{S4}$ background uncertainty & 0.18\% & 0.16\% & 1.1\% & 1.4\% & 8.1\% \\
    \hline
    \textbf{Total} & 11.5\% & 16.0\% & 14.7\% & 18.3\% & 18.9\% \\
    \hline 
  \end{tabular}
  \label{tab:systematics}
\end{table}

The ratio of number of protons reaching $\mathit{S4}$ to those reaching $\mathit{S3}$ is shown for both simulation and data in Table~\ref{tab:ratios}, which includes the total statistical and systematic error in each case.
The agreement shown relative to the uncertainty provided by the beam test setup provides strong evidence that efficiency corrections described in Section~\ref{timeofflightanalysissubsec} are justified.
%The discrepancy in the 4 block case is due to the low energy of the protons.
%In this case, the proton energy spectrum is very sensitive to additional material in the beamline which would cause a large number of protons to be absorbed.

The number of simulated particles that penetrate the active area of the TPC are shown in Figure~\ref{fig:MCTPC}, left and right, as a function of momentum and kinetic energy respectively.
Comparing Figure~\ref{fig:MCTPC}, right, with the motivation plot shown in Figure~\ref{fig:protonsfromargon}, it is clear that 4 moderator blocks were required to access the momentum region of interest (below 50 MeV).
The off axis and moderator technique were therefore successful in the extent to which the proton energy was lowered.
The number of protons reaching the active area of the TPC was  per spill ($7.0 \pm  0.1$) for 4 moderator blocks, compared with ($12.6 \pm 0.7$) per spill without moderation. 
For 4 moderator blocks, ($5.6 \pm  0.1$) of those protons had energies below 100~MeV.
These values were calibrated with the full comparison between data and simulation.

\begin{table}
  \centering
  \caption{Ratio of number of protons reaching $\mathit{S4}$ to number protons reaching $\mathit{S3}$ for different numbers of moderator blocks in MC and data. In each instance, the combined statistical and systematic errors are shown.}
  \begin{tabular}{c|c c c}
    \hline
    \hline
    Number of moderator blocks & Monte Carlo & Data & Data/MC\\
    \hline
    $0$ & $0.027 \pm 0.003$ & $0.049 \pm 0.007$ & $1.8 \pm 0.3$ \\
    $1$ & $0.067 \pm 0.005$ & $0.09 \pm 0.01$ & $1.3 \pm 0.2$ \\
    $2$ & $0.084 \pm 0.007$ & $0.10 \pm 0.01$ & $1.2 \pm 0.2$ \\
    $3$ & $0.06 \pm 0.01$ & $0.036 \pm 0.007$ & $0.7 \pm 0.2$ \\
    $4$ & $0.011 \pm 0.001$ & $0.008 \pm 0.001$ & $0.7 \pm 0.1$ \\
    \hline
  \end{tabular}
  \label{tab:ratios}
\end{table}

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/momTpc.tex}
    \end{adjustbox}
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/keTpc.tex}
    \end{adjustbox}
    
  \end{minipage}
  \caption{Left: Momentum profile of simulated protons reaching the active region of the TPC. Right: Energy profile of simulated protons reaching the active region of the TPC.}
  \label{fig:MCTPC}	
\end{figure}
    
