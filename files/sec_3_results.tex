\section{Beam Flux Measurement}
\label{hptpcPaper:sec:Results}

\subsection{Flux measurements with S3}

The ToF systems are at an off-axis angle with respect to the beam axis (see table~\ref{tab:angS1}), in order to reduce the proton momentum spectrum to cover the region most relevant for neutrino experiments.
This is quantified in terms of the two off-axis angles.
These angles are defined as detailed in section~\ref{sec:coord}.

\begin{figure}[ht]
  \centering
  \begin{minipage}[t]{0.49\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}, center}
      \input{files/Figures/proMomS1.tex}
    \end{adjustbox}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{0.49\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}, center}
      \input{files/Figures/proMomTpc.tex}
    \end{adjustbox}
  \end{minipage}
  \caption{\label{fig:s3promom}Proton momentum spectrum as measured in $\mathit{S3}$. Left: all protons. Right: the subset of protons passing through the HPTPC drift volume}
\end{figure}

\begin{figure}[ht]
  \centering
  \begin{adjustbox}{max totalsize={0.5\textwidth}, center}
      \input{files/Figures/protonKeTpc.tex}
  \end{adjustbox}
  \caption{Proton kinetic energy spectrum as measured in $\mathit{S3}$ for those protons passing through the HPTPC drift volume.}
  \label{fig:tpcproke}
\end{figure}

The proton spectra upstream of the TPC are shown in figures~\ref{fig:s3promom} and \ref{fig:tpcproke}. 
Figure~\ref{fig:s3promom}, left, shows the momentum of particles identified as protons is successfully reduced with increasing numbers of moderator blocks, with the range falling from 0.65-0.85~GeV/c for the unmoderated beam, to 0.30-0.45~GeV/c for 4~acrylic blocks.
Figure~\ref{fig:s3promom}, right, shows the momentum spectrum of those protons whose trajectory will carry them through the HPTPC volume.
%The angular range of the TPC is stated in table~\ref{tab:angS1}.
This figure indicates that the flux of low momentum protons (those with a momentum of less than 0.4~GeV/c) reaching the TPC was increased from negligible in the 0, 1, and 2 block cases to ($9.65 \pm 0.13$) per spill for the 4 block case.
Figure~\ref{fig:tpcproke} shows the kinetic energy spectrum of protons crossing into the time projection chamber.
Comparing figure~\ref{fig:tpcproke} with figure~\ref{fig:protonsfromargon} shows that, for the four moderator block case, the kinetic energy of protons incident upon the TPC is just above the 50~MeV region where the different neutrino interaction generators become discrepant.
These protons lose further energy within the walls of the HPTPC vessel, resulting in a flux of protons below 50~MeV within the TPC.

The combination of the use of moderator blocks and positioning the TPC in an off-axis position also caused a change in the multiplicity of protons passing through the TPC.
Figure~\ref{fig:s3promom} shows that the addition of 1, 2, and 3 moderator blocks increased the number of protons passing through the TPC from ($19.0 \pm 0.9$) per spill in the unmoderated case to ($108 \pm 3$) per spill in the 3 block case.
The addition of the fourth moderator block effectively removes the flux of protons above 100~MeV, leaving ($21.4 \pm 0.2$) per spill to traverse the TPC active volume.
  
\begin{figure}[h]
  \begin{minipage}{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/thetaS1pi.tex}
    \end{adjustbox}
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/thetaS1pro.tex}
    \end{adjustbox}
  \end{minipage}
    \caption{\label{fig:s1s3mips}Distribution of hits in $\mathit{S3}$ as a function of the horizontal off-axis angle, measured from $\mathit{S1}$, for varying numbers of moderator blocks. No coincident hit in $\mathit{S2}$ was required. Left: minimum ionizing particles. Right: protons.}
\end{figure}

The distributions vs. off-axis angle of MIPs and protons in $\mathit{S3}$ are shown in figure~\ref{fig:s1s3mips}.
In both cases, the peak beam intensity falls and broadens in $\theta$ with the increasing number of moderator blocks. 
At off-axis angles the number of MIPs and protons is increased as the number of moderator blocks is increased.
The TPC lies within this off-axis region.
The spread of particles for unmoderated data was unexpected; this peak was broadened by the beam steering scattering that led to the double proton peaks seen in figures~\ref{fig:s3tof} and \ref{fig:s3tof_mass}.


Figure~\ref{fig:propiratio_s3_horz} shows the proton-MIP ratio measured in $\mathit{S3}$ as a function of the nominal off-axis angle, horizontally and vertically respectively, and for various numbers of moderator blocks.
For 0, 1, 2, and 3 moderator blocks the ratio falls to a minimum at approximately $1^{\circ}$ with respect to the beam axis.
This corresponds to the true beam centre.
As the angle moves away from the true beam centre, the ratio rises for these configurations.
The peak of the proton-MIP ratio shifts away from the beam centre progressively as more moderator blocks are added (from approximately 1$^{\circ}$ away from beam centre for 0 blocks up to approximately 3$^{\circ}$ away from beam centre for 3 blocks).
At most values of $\theta$, the proton-MIP ratio falls with the addition of more moderator blocks. 
In other words, reducing the kinetic energy of the protons below 100~MeV came at the cost of reducing the purity of the proton beam.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/thetaS1ratio.tex}
    \end{adjustbox}
    
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/phiS1ratio.tex}
    \end{adjustbox}
  \end{minipage}	
  \caption{\label{fig:propiratio_s3_horz}Proton-MIP ratio in $\mathit{S3}$ for varying numbers of moderator blocks as a function of off-axis angle, as measured from $\mathit{S1}$.  Left: horizontal angle. Right: vertical angle. The TPC spans horizontal angles 1.4--3.6$^{ \circ }$. and vertical angles -2.6--+2.6$^{ \circ }$.}
\end{figure}

Note that the kinetic energy of these particles is further reduced as they pass through the steel walls of the vessel on their path to the TPC region.

\subsection{Flux measurements with S4}

Figure~\ref{fig:thetas4mip}, left, shows the flux of particles identified as minimum ionizing particles across $\mathit{S4}$.
This flux is shown as as a function of the off-axis angles defined in section~\ref{sec:coord} for varying numbers of moderator blocks.
For all numbers of moderator blocks, the peak number of minimum ionizing particle events occurs at a value of $\theta$ between $-1^{\circ}$ and $-2^{\circ}$.
Similarly the number of proton events per spill, shown in figure~\ref{fig:thetas4mip}, right, peaks at a value of $\theta$ of approximately $-2^{\circ}$.
The fall in the number of events between $\theta = -1^{\circ}$ and $\theta = 0^{\circ}$ is as a result of the beam impinging on the vessel doors at these angles.
The positioning and shape of the pressure vessel doors means that, for particles travelling at these angles, a greater length of steel is passed through compared to those particles which strike the body of the vessel.

%The angular overlap of $\mathit{S2}$ and $\mathit{S4}$ plays a role in the position of the peak. 
%Figure~\ref{fig:angularDistS1} shows that, when observed from $\mathit{S1}$, a limited area of $\mathit{S4}$ is shadowed by the active area of $\mathit{S2}$.
%Given the requirement that a signal must be observed in $\mathit{S2}$, it is clear that all of the events that are observed in $\mathit{S4}$ are from this region of overlap.

Figure~\ref{fig:thetas4mip}. left, also shows that initially, an increasing number of moderator blocks results in an increased total MIP flux through $\mathit{S4}$. 
This is because both $\mathit{S2}$ and $\mathit{S4}$ are positioned off-axis, so the unmoderated beam particles do not strike these detectors.
Due to scattering processes in the moderator, a greater number of MIPs are incident upon $\mathit{S2}$ and $\mathit{S4}$, with more scattering occurring with greater numbers of moderator blocks.
However, with the fourth moderator block the flux of MIPs is seen to fall.
%The drop off in the number of MIPs observed in the four block data is likely due to the overscattering of the protons and MIPs as stated previously.
Similarly, with the addition of the first two moderator blocks, the proton flux shown in figure~\ref{fig:thetas4mip}, right, initially sees an increase in the total number of events in $\mathit{S4}$.
However, with three and four moderator blocks, the total number of protons observed in $\mathit{S4}$ falls.
The initial proton flux increase is similar to that for the MIP flux, with increased scattering causing more protons to pass through the off-axis $\mathit{S2}$ and $\mathit{S4}$ detectors.
The subsequent decrease is due to the larger loss of energy of the protons in the thicker moderator.
In turn, this leads to attenuation of protons in the pressure vessel resulting in fewer observed events in $\mathit{S4}$.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/piS4Horz_new.tex}
    \end{adjustbox}
    
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight},center}
      \input{files/Figures/proS4Horz_new.tex}
    \end{adjustbox}
  \end{minipage} 
  \caption{\label{fig:thetas4mip}Distribution of hits in $\mathit{S4}$ as a function of the number of moderator blocks and the horizontal off-axis angle. Left: minimum ionizing particles. Right: protons.}
\end{figure}	

Figure~\ref{fig:propiratio_s4_horz} shows the ratio of protons to MIPs as a function of the number of moderator blocks and the two off-axis angles.
For all of the different block configurations, the ratio is flat across both $\theta$ and $\phi$.
With the addition of moderator blocks, the ratio reduces from its highest level of 0.5 for the 0 block case, to 0.01 for the 4 block data.
As mentioned previously, this is thought to be due to the attenuation of low energy protons within the walls of the pressure vessel.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/ratioS4Horz_new.tex}
    \end{adjustbox}
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/ratioS4Vert_new.tex}
    \end{adjustbox}
  \end{minipage}	
  \caption{\label{fig:propiratio_s4_horz}Proton-MIP ratio in $\mathit{S4}$ for varying numbers of moderator blocks as a function of off-axis angle. Left: horizontal off-axis angle. Right: vertical off-axis angle.}
\end{figure}

\subsection{Monte Carlo Studies}
In order to ascertain the flux of protons reaching the active region of the TPC, and verify the corrections described above, a Monte Carlo (MC) simulation study was performed. 
In order to match upstream conditions as closely as possible, particle momenta were drawn from the $\mathit{S3}$ distributions shown in figure~\ref{fig:s3promom}, left, and simulated with trajectories that resulted in the same position distribution as seen in figure~\ref{fig:s3XY_pion}, left.
The same timing cuts described in section~\ref{timeofflightanalysissubsec} were applied.
%The initial simulation profile is constructed identically from the momentum profile shown in figure~\ref{fig:s3promom}.

%\begin{figure}[!ht]
%  \begin{minipage}[t]{0.48\textwidth}
%   \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
%      \input{files/Figures/S3MC.tex}
%   \end{adjustbox}
 %   \caption{Initial simulation momentum profile of protons penetrating the $\mathit{S3}$ wall in the direction of the TPC}
 %   \label{fig:MCS3}
 % \end{minipage}
 % \hspace{0.3cm}
 % \begin{minipage}[t]{0.48\textwidth}
 %   \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
 %     \input{files/Figures/momS4NoLog.tex}
 %   \end{adjustbox}
 %   \caption{Momentum profile of simulated protons reaching $\mathit{S4}$, with momentum above the detection threshold of 140~MeV/c}
%    \label{fig:MCS4}
 % \end{minipage}	
%\end{figure}

\begin{figure}[ht]
  \centering
     \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/momS4NoLog.tex}
    \end{adjustbox}
    \caption{Momentum profile of simulated protons reaching $\mathit{S4}$, with kinetic energy above the detection threshold of 10~MeV.}
    \label{fig:MCS4}
\end{figure}

The simulated protons are propagated through the vessel to the $\mathit{S4}$ detector.
The momentum profile of simulated protons reaching the $\mathit{S4}$ wall is shown in figure~\ref{fig:MCS4}.
A proton detection threshold of $\mathit{S4}$ of 140~MeV/c (10~MeV kinetic energy) included.
The simulation shows a significant reduction in kinetic energy as most particles have travelled through both steel walls of the TPC vessel.
In particular, in the 4 moderator block case, very few particles have survived through the second vessel wall to reach $\mathit{S4}$.
The ratio of number of protons reaching $\mathit{S4}$ to those reaching $\mathit{S3}$ is shown for both simulation and data in table~\ref{tab:ratios}, which includes the total statistical and systematic error in each case.

Systematic uncertainties on the number of protons measured in $\mathit{S3}$ and $\mathit{S4}$ are estimated for both data and Monte Carlo, and shown in table~\ref{tab:systematics}.
The systematic uncertainty on the MC simulation is determined by varying the geometric initial conditions of the simulation, including the position of the $\mathit{S1}$ and $\mathit{S2}$ detectors.
These variations induce changes in the direction and momenta of the propagated protons.
Additionally, a study was performed with 1~cm of additional acrylic in the beamline, as a proxy for the uncertainty on other pieces of light material in the beam facility.
This set of calculated errors represents geometric sources of uncertainty in the MC simulation.

For the data, the $\mathit{S4}$ angular correction systematic uncertainty is assessed by varying the number of horizontal bins in figure~\ref{fig:s4PosEff} from 20 to 10.
The uncertainty on the $\mathit{S4}$ background subtraction is determined by modelling the background as both flat and exponential. The difference in $\mathit{S4}$ proton counts in these two cases is used as the systematic.
This has a very large effect in the 4 block case because of the very small number of protons detected in $\mathit{S4}$ relative to the background.

\begin{table}
	\centering
	\caption{List of systematic errors and values for data and Monte Carlo simulation. All values are the fractional error on the $\mathit{S4}$ proton count with the exception of the uncertainty on the efficiency of $\mathit{S3}$, which is the fractional error in the $\mathit{S3}$ proton count. All uncertainties are treated as uncorrelated. $n_{\mathit{S4},~MC}$ refers to the number of protons reaching $\mathit{S4}$ in Monte Carlo simulations.}
	\begin{tabular}{|c|c c c c c|}
		\hline 
		\multicolumn{6}{|c|}{\textbf{Monte Carlo}} \\
		\hline
		& \multicolumn{5}{c|}{Number of moderator blocks} \\
		& 0 & 1 & 2 & 3 & 4 \\
		\hline
		Systematic uncertainty on $n_{\mathit{S4},~MC}$ & 0.095 & 0.08 & 0.085 & 0.171 & 0.08 \\
		\hline
		\hline
		\multicolumn{6}{|c|}{\textbf{Data}} \\
		\hline
		& \multicolumn{5}{c|}{Number of moderator blocks} \\
		Source of systematic error & 0 & 1 & 2 & 3 & 4 \\
		\hline
		Absolute efficiency of $\mathit{S3}$ & 0.1 & 0.1 & 0.1 & 0.1 & 0.1 \\
		Absolute efficiency of $\mathit{S4}$ & 0.1 & 0.1 & 0.1 & 0.1 & 0.1 \\ 
		$\mathit{S4}$ angular correction & 0.029 & 0.015 & 0.067 & 0.082 & 0.041 \\
		$\mathit{S4}$ background uncertainty & 0.016 & 0.014 & 0.042 & 0.100 & 0.776 \\
		\hline
		\textbf{Total} & 0.145 & 0.143 & 0.162 & 0.192 & 0.790 \\
		\hline 
	\end{tabular}
	\label{tab:systematics}
\end{table}

The agreement shown in the 0, 1, 2, and 3 block cases relative to the uncertainty provided by the beam test setup provides strong evidence that efficiency corrections described in section~\ref{timeofflightanalysissubsec} are justified.
%it is not known if additional small quantities of light moderating material were present in the beamline which are not accounted for in the statistical errors.
The larger discrepancy in the 4 block case is due to the low energy of the protons.
In this case, the proton energy spectrum is very sensitive to additional material in the beamline which would cause a large number of protons to be absorbed.

\begin{table}
  \centering
  \caption{Ratio of number of protons reaching $\mathit{S4}$ to number protons reaching $\mathit{S3}$ for different numbers of moderator blocks in MC and data. In each instance, the combined statistical and systematic errors are shown.}
  \begin{tabular}{|c|c|c|c|}
    \hline 
    Number of moderator blocks & Monte Carlo & Data & Data/MC\\
    \hline
    $0$ & $0.027 \pm 0.003$ & $0.050 \pm 0.005$ & $1.8 \pm 0.3$ \\
    $1$ & $0.067 \pm 0.005$ & $0.090 \pm 0.009$ & $1.3 \pm 0.2$ \\
    $2$ & $0.084 \pm 0.007$ & $0.104 \pm 0.013$ & $1.2 \pm 0.2$ \\
    $3$ & $0.055 \pm 0.010$ & $0.046 \pm 0.008$ & $0.8 \pm 0.2$ \\
    $4$ & $0.0115 \pm 0.0010$ & $0.035 \pm 0.027$ & $3.0 \pm 2.4$ \\
    \hline
  \end{tabular}
  \label{tab:ratios}
\end{table}

The number of simulated particles that penetrate the active area of the TPC are shown in figures~\ref{fig:MCTPC} and~\ref{fig:MCKE} as a function of momentum and kinetic energy respectively.
Comparing figure~\ref{fig:MCKE} with the motivation plot shown in figure~\ref{fig:protonsfromargon}, it is clear that 4 moderator blocks were required to access the momentum region of interest (below 50 MeV).
The off axis and moderator technique were therefore successful in the extent to which the proton energy was lowered.
The number of protons reaching the active area of the TPC was  per spill ($6.97 \pm  0.11$) for 4 moderator blocks, compared with ($12.6 \pm 0.7$) per spill without moderation. 
For 4 moderator blocks, ($5.56 \pm  0.10$) of those protons had energies below 100~MeV.
These values were calibrated with the full comparison between data and simulation.

\begin{figure}[!ht]
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/momTpc.tex}
    \end{adjustbox}
    \caption{Momentum profile of simulated protons reaching the active region of the TPC}
    \label{fig:MCTPC}
  \end{minipage}
  \hspace{0.3cm}
  \begin{minipage}[t]{0.48\textwidth}
    \begin{adjustbox}{max totalsize={\textwidth}{.35\textheight}, center}
      \input{files/Figures/keTpc.tex}
    \end{adjustbox}
    \caption{Energy profile of simulated protons reaching the active region of the TPC}
    \label{fig:MCKE}
  \end{minipage}	
\end{figure}
    
